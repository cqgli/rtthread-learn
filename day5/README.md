- 

# 【2024-RSOC】软件包和组件

## Rt-thread软件包

**IOT，外设，系统，编程语言，工具，杂类，多媒体，安全，嵌入式AI，Arduino，信号处理**

#### 定义：具有特定的功能，用来完成特定任务的一个程序或一组程序。RT-Thread软件包是针对RT-Thread实时操作系统的功能模块或驱动程序的集合，通过这些软件包可以方便地扩展和定制RTOS的功能。

#### 温度湿度传感器——AHT10

##### 1.正常驱动传感器设备

1. 找到传感器命令
2. 找到I2C设备
3. 利用API编写驱动，包括写命令`write_reg()`、读命令`read()`、获取参数命令…

##### 2.使用软件包驱动

1. 打开板上外设AHT32开关
2. 因为Kconfig里面关联了，所以不用再次打开软件包
3. 查看确认一下
4. 搜索rt_vsprintf_full软件包（支持浮点输出）

### MQTT

#### 1.概念和简介

MQTT（Message Queuing Telemetry Transport）是一种轻量级、基于发布-订阅模式的消息传输协议，适用于资源受限的设备和低带宽、高延迟或不稳定的网络环境。它在物联网应用中广受欢迎，能够实现传感器、执行器和其它设备之间的高效通信。

特点：

- **轻量级：**物联网设备通常在处理能力、内存和能耗方面受到限制。MQTT 开销低、报文小的特点使其非常适合这些设备，因为它消耗更少的资源，即使在有限的能力下也能实现高效的通信。

- **可靠：**物联网网络常常面临高延迟或连接不稳定的情况。MQTT 支持多种 QoS 等级、会话感知和持久连接，即使在困难的条件下也能保证消息的可靠传递，使其非常适合物联网应用。

  三种Qos等级：最多一次（QoS0）、至少一次（QoS1）、仅一次（QoS2）

- **便于拓展：**如果有设备需要获取某个传感器的消息，只需要订阅这个主题就好了。

#### 2.常见用法

客户端（Client）：MQTT 协议中的通信实体，可以是发布者、订阅者或同时兼具两者的设备。

代理（Broker）：MQTT 网络中的服务器，负责接收和转发消息。

主题（Topic）：MQTT 消息的分类标识，用于订阅和发布消息。

发布者（Publisher）：将消息发布到指定主题的客户端。

订阅者（Subscriber）：订阅特定主题的客户端，可以接收到发布者发送的消息。

在 MQTT 中，客户端可以通过订阅主题来接收感兴趣的消息，也可以通过发布消息到特定主题来将数据发送给订阅者。以下是一些 MQTT 的基本操作：

连接（Connect）：客户端连接到 MQTT 代理。

订阅（Subscribe）：客户端向代理订阅一个或多个主题。

取消订阅（Unsubscribe）：客户端取消订阅一个或多个已订阅的主题。

发布（Publish）：客户端向指定的主题发布消息。

接收（Receive）：订阅者接收到发布者发送的消息。

## 组件

### 文件系统（学习如何使用W25Q64挂载文件系统）

#### 1.概述

RT-Thread 提供了多个文件系统组件，用于在嵌入式系统中实现文件管理和存储功能。以下是一些常用的 RT-Thread 文件系统组件：

FAT 文件系统（FATFS）：FATFS 是一种常用的文件系统，RT-Thread 提供了对 FATFS 的支持。它能够在嵌入式系统中实现对 SD 卡、FLASH 存储器等存储介质的文件读写和管理。通过使用 FATFS，可以实现文件的创建、删除、读写、移动等操作。

ROM 文件系统（ROMFS）：ROMFS 是一种只读文件系统，适用于小型系统或只需要读取文件的应用场景。RT-Thread 提供了对 ROMFS 的支持，可以将文件系统镜像固化在系统的只读存储介质中，以提供文件的读取功能。

YAFFS 文件系统：YAFFS（Yet Another Flash File System）是一种专为嵌入式系统设计的闪存文件系统。RT-Thread 提供了对 YAFFS 的支持，可以在嵌入式系统中实现对 NAND FLASH 等闪存设备的文件读写和管理。

SPIFFS 文件系统：SPIFFS 是一种适用于闪存设备的嵌入式文件系统，它以较低的存储占用和较快的读写速度著称。RT-Thread 提供了对 SPIFFS 的支持，可以在具有 SPI 接口的闪存设备上实现文件读写和管理。


![image-20240726201149111](C:\Users\27545\AppData\Roaming\Typora\typora-user-images\image-20240726201149111.png)

### FAL软件包

#### 简介

FAL (Flash Abstraction Layer) Flash 抽象层，是 RT-Thread 的一个软件包，是对 Flash 及基于 Flash的分区进行管理、操作的抽象层，对上层统一了 Flash 及分区操作的 API ，并具有以下特性：

• 支持静态可配置的分区表，并可关联多个 Flash 设备；

• 分区表支持 自动装载。避免在多固件项目，分区表被多次定义的问题；

• 代码精简，对操作系统 无依赖，可运行于裸机平台，比如对资源有一定要求的 bootloader；

• 统一的操作接口。保证了文件系统、 OTA、 NVM 等对 Flash 有一定依赖的组件，底层 Flash 驱动的可重用性；

• 自带基于 Finsh/MSH 的测试命令，可以通过 Shell 按字节寻址的方式操作（读写擦） Flash 或分区，方便开发者进行调试、测试；

#### 文件系统结合FAL使用W25Q64

![image-20240726202035775](C:\Users\27545\AppData\Roaming\Typora\typora-user-images\image-20240726202035775.png)

### 课后作业

![image-20240727175045884](C:\Users\27545\AppData\Roaming\Typora\typora-user-images\image-20240727175045884.png)
